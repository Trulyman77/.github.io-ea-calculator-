<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EAï¼ˆEnergy Availabilityï¼‰è¨ˆç®—æ©Ÿï½œé‹å‹•ç‡Ÿé¤Š</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #121821;
      --muted: #7f8da3;
      --text: #e8eef7;
      --accent: #6ee7ff;
      --accent-2: #8bffb0;
      --warn: #ffd166;
      --danger: #ff6b6b;
      --ok: #9cff7a;
      --ring: rgba(110, 231, 255, .45);
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 18px;
    }
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(135deg,#0b0f14 0%,#0e1420 50%,#0b0f14 100%);
      color:var(--text); font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans TC, Helvetica, Arial;
      display:grid; place-items:start center; padding:32px; box-sizing:border-box;
    }
    .app{width:min(980px,100%);}
    .title{display:flex; gap:14px; align-items:center; margin-bottom:16px}
    .badge{font-weight:600; letter-spacing:.04em; border:1px solid #2b3443; color:var(--muted); padding:6px 10px; border-radius:999px;}
    h1{margin:.2rem 0 0; font-size:clamp(22px,2.2vw,28px)}
    .card{background:var(--card); border:1px solid #1d2633; border-radius:var(--radius); box-shadow:var(--shadow);}
    .grid{display:grid; gap:18px}
    .twocol{grid-template-columns:1fr 1fr}
    @media (max-width: 820px){.twocol{grid-template-columns:1fr}}
    .section{padding:20px}
    .section + .section{border-top:1px solid #1d2633}
    .row{display:grid; gap:12px; grid-template-columns:240px 1fr; align-items:center}
    @media (max-width: 700px){.row{grid-template-columns:1fr}}
    label{color:var(--muted); font-weight:600}
    .hint{color:#9aa7be; font-size:.9em}
    input, select, button, textarea{font:inherit; color:var(--text)}
    input[type="number"], input[type="text"], select{
      width:100%; padding:12px 14px; border-radius:12px; background:#0e141d; border:1px solid #243040; outline:none;
    }
    input:focus, select:focus, textarea:focus{box-shadow:0 0 0 4px var(--ring)}
    .subtle{color:var(--muted)}
    .inline{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .divider{height:1px; background:#1d2633; margin:8px 0 12px}
    .pill{display:inline-flex; align-items:center; gap:8px; border-radius:999px; padding:8px 12px; border:1px solid #243040; background:#0d141e}
    .pill b{letter-spacing:.02em}
    .muted{color:#9fb0c9}
    .kpi{display:grid; gap:12px; grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 820px){.kpi{grid-template-columns:1fr}}
    .kpi .box{padding:16px; border-radius:14px; border:1px solid #223045; background:#0f1621}
    .kpi .big{font-size:clamp(22px,3.2vw,28px); font-weight:800}
    .tag{display:inline-block; padding:.2em .55em; border-radius:8px; font-weight:700}
    .ok{background:rgba(156,255,122,.12); color:var(--ok); border:1px solid rgba(156,255,122,.35)}
    .mid{background:rgba(255,209,102,.12); color:var(--warn); border:1px solid rgba(255,209,102,.35)}
    .low{background:rgba(255,107,107,.12); color:var(--danger); border:1px solid rgba(255,107,107,.35)}
    details{background:#0e151f; border:1px dashed #2a394f; border-radius:12px; padding:12px 14px}
    summary{cursor:pointer; color:#cfe7ff; font-weight:700}
    table{width:100%; border-collapse:collapse}
    th, td{padding:10px 8px; border-bottom:1px dashed #223045; text-align:left}
    tfoot td{border-top:1px solid #223045; border-bottom:none; font-weight:800}
    .actions{display:flex; gap:10px; flex-wrap:wrap}
    .btn{background:#0e151f; border:1px solid #2a394f; border-radius:12px; padding:10px 14px; cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#1a98ff,#00d4ff); border:none; color:#00111a; font-weight:800}
    .right{display:flex; justify-content:flex-end}
    .footer{color:#8aa4c4; font-size:.9em}
    .small{font-size:.92em}
    .note{padding:12px 14px; border-radius:12px; background:#0f1726; border:1px solid #223045}
    .flex{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <main class="app">
    <div class="title">
      <span class="badge">é‹å‹•ç‡Ÿé¤Š â€¢ EA è¨ˆç®—</span>
      <h1>Energy Availabilityï¼ˆèƒ½é‡å¯ç”¨æ€§ï¼‰å–®é è¨ˆç®—æ©Ÿ</h1>
    </div>

    <section class="card grid">
      <div class="section grid twocol">
        <div>
          <div class="row">
            <label for="sex">æ€§åˆ¥ï¼ˆåƒ…ç”¨æ–¼èªªæ˜èˆ‡å»ºè­°ï¼‰</label>
            <select id="sex">
              <option value="female">å¥³æ€§</option>
              <option value="male">ç”·æ€§</option>
              <option value="na">ä¸æŒ‡å®š</option>
            </select>
          </div>
          <div class="row">
            <label>FFM ä¾†æºï¼ˆæ“‡ä¸€ï¼‰<div class="hint">FFM=å»è„‚é«”é‡ï¼›å¯ç›´æ¥è¼¸å…¥ï¼Œæˆ–ç”¨é«”é‡Ã—(1âˆ’é«”è„‚ï¼…)ä¼°ç®—</div></label>
            <div>
              <div class="inline">
                <label class="pill"><input type="radio" name="ffmMode" value="calc" checked> ä¾é«”é‡ï¼‹é«”è„‚ç‡ä¼°ç®—</label>
                <label class="pill"><input type="radio" name="ffmMode" value="direct"> ç›´æ¥è¼¸å…¥ FFM</label>
              </div>
              <div id="ffmCalc">
                <div class="divider"></div>
                <div class="grid twocol">
                  <div>
                    <label for="weight" class="subtle">é«”é‡ï¼ˆkgï¼‰</label>
                    <input id="weight" type="number" min="20" step="0.1" placeholder="ä¾‹å¦‚ 60" />
                  </div>
                  <div>
                    <label for="bodyfat" class="subtle">é«”è„‚ç‡ï¼ˆ%ï¼‰</label>
                    <input id="bodyfat" type="number" min="0" max="65" step="0.1" placeholder="ä¾‹å¦‚ 18" />
                  </div>
                </div>
              </div>
              <div id="ffmDirect" style="display:none">
                <div class="divider"></div>
                <label for="ffm" class="subtle">FFM å»è„‚é«”é‡ï¼ˆkgï¼‰</label>
                <input id="ffm" type="number" min="20" step="0.1" placeholder="ä¾‹å¦‚ 49.2" />
              </div>
            </div>
          </div>
          <div class="row">
            <label for="ei">èƒ½é‡æ”å– EIï¼ˆkcal/å¤©ï¼‰</label>
            <input id="ei" type="number" min="0" step="1" placeholder="ä¾‹å¦‚ 2400" />
          </div>
          <div class="row">
            <label for="eee">é‹å‹•èƒ½é‡æ¶ˆè€— EEEï¼ˆkcal/å¤©ï¼‰</label>
            <div>
              <input id="eee" type="number" min="0" step="1" placeholder="ä¾‹å¦‚ 600" />
              <div class="hint small">è‹¥ä¸ç¢ºå®šï¼Œå¯å±•é–‹ä¸‹æ–¹ä¼°ç®—å™¨ç”±æ´»å‹•å¼·åº¦ï¼ˆMETï¼‰èˆ‡æ™‚é–“ä¼°ç®— EEEã€‚</div>
            </div>
          </div>
        </div>
        <div>
          <div class="kpi">
            <div class="box">
              <div class="muted small">å…¬å¼</div>
              <div class="big">EA = (EI âˆ’ EEE) Ã· FFM</div>
              <div class="small muted">å–®ä½ï¼škcal / kg FFM / day</div>
            </div>
            <div class="box">
              <div class="muted small">è¨ˆç®—çµæœ</div>
              <div class="big" id="eaValue">â€”</div>
              <div class="small"><span id="eaClass" class="tag mid">â€”</span></div>
            </div>
            <div class="box">
              <div class="muted small">FFMï¼ˆä¼°ç®—æˆ–è¼¸å…¥ï¼‰</div>
              <div class="big" id="ffmPreview">â€”</div>
              <div class="small muted" id="ffmNote">æœªæä¾›é«”é‡/é«”è„‚æˆ– FFM</div>
            </div>
          </div>
          <div class="divider"></div>
          <div class="note small" id="advice">è«‹è¼¸å…¥æ•¸æ“šä»¥å–å¾—å»ºè­°ã€‚</div>
        </div>
      </div>

      <div class="section">
        <details>
          <summary>å±•é–‹ï¼šç”¨ MET Ã— æ™‚é–“ ä¼°ç®—æ¯æ—¥ EEE</summary>
          <div class="hint" style="margin:8px 0 14px">å…¬å¼ï¼škcal â‰ˆ MET Ã— 3.5 Ã— é«”é‡(kg) Ã· 200 Ã— åˆ†é˜ï¼›è«‹åŠ å…¥åŒä¸€å¤©å…§çš„æ‰€æœ‰é‹å‹•ã€‚</div>
          <div class="actions" style="margin-bottom:10px">
            <button class="btn" id="addAct">ï¼‹æ–°å¢æ´»å‹•</button>
            <button class="btn" id="clearAct">æ¸…ç©º</button>
          </div>
          <div class="tableWrap">
            <table id="actTable" aria-label="æ´»å‹•åˆ—è¡¨">
              <thead>
                <tr><th>#</th><th>æ´»å‹•</th><th>MET</th><th>åˆ†é˜</th><th>é«”é‡(kg)</th><th>ä¼°ç®—æ¶ˆè€— (kcal)</th><th></th></tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr><td colspan="5" class="right">åˆè¨ˆ</td><td id="eeeSum">0</td><td></td></tr>
              </tfoot>
            </table>
          </div>
          <div class="actions" style="margin-top:12px">
            <button class="btn primary" id="applyEEE">å¥—ç”¨åˆè¨ˆåˆ° EEE æ¬„ä½</button>
          </div>
        </details>
      </div>

      <div class="section grid twocol">
        <div>
          <div class="inline">
            <span class="pill"><b>å»ºè­°å€é–“</b>ï¼š<span class="muted">æœ€ä½³ â‰³ 45</span></span>
            <span class="pill"><b>æ³¨æ„</b>ï¼š<span class="muted">30â€“45ï¼ˆå¯èƒ½ä¸è¶³ï¼‰</span></span>
            <span class="pill"><b>é¢¨éšª</b>ï¼š<span class="muted">ï¼œ 30ï¼ˆRED-S é¢¨éšªé«˜ï¼‰</span></span>
          </div>
          <p class="small muted" style="margin-top:8px">è¨»ï¼šå€é–“ä¾é‹å‹•ç‡Ÿé¤Šæ–‡ç»å¸¸ç”¨é–€æª»ï¼›å€‹é«”å·®ç•°å­˜åœ¨ï¼Œè«‹æ­é…å°ˆæ¥­è©•ä¼°ã€‚</p>
        </div>
        <div class="actions right">
          <button class="btn" id="demoF">è¼‰å…¥ç¯„ä¾‹ï¼šå¥³æ€§ 48kg</button>
          <button class="btn" id="demoM">è¼‰å…¥ç¯„ä¾‹ï¼šç”·æ€§ 60kg</button>
          <button class="btn" id="reset">é‡è¨­</button>
          <button class="btn primary" id="calc">ç«‹å³è¨ˆç®—</button>
        </div>
      </div>

      <div class="section footer">
        <div class="small">
          æœ¬å·¥å…·åƒ…ä½œæ•™è‚²ç”¨é€”ï¼Œéé†«ç™‚è¨ºæ–·ï¼›è‹¥ç–‘ä¼¼ä½èƒ½é‡å¯ç”¨æ€§ï¼ˆLEAï¼‰æˆ– REDâ€‘Sï¼Œè«‹è«®è©¢åˆæ ¼é‹å‹•ç‡Ÿé¤Šå¸« / é†«å¸«ã€‚
        </div>
      </div>
    </section>
  </main>

  <script>
    // Utility helpers
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];
    const clamp = (n,min,max)=>Math.min(Math.max(n,min),max);

    // Elements
    const sexEl = $('#sex');
    const ffmModeEls = $$('input[name="ffmMode"]');
    const ffmCalcBox = $('#ffmCalc');
    const ffmDirectBox = $('#ffmDirect');
    const weightEl = $('#weight');
    const bodyfatEl = $('#bodyfat');
    const ffmEl = $('#ffm');
    const eiEl = $('#ei');
    const eeeEl = $('#eee');
    const eaValueEl = $('#eaValue');
    const eaClassEl = $('#eaClass');
    const ffmPreviewEl = $('#ffmPreview');
    const ffmNoteEl = $('#ffmNote');
    const adviceEl = $('#advice');

    // Activity table for EEE estimation
    const actTableBody = $('#actTable tbody');
    const eeeSumEl = $('#eeeSum');

    // Switch FFM input mode
    ffmModeEls.forEach(r => r.addEventListener('change', () => {
      const mode = $('input[name="ffmMode"]:checked').value;
      ffmCalcBox.style.display = mode === 'calc' ? '' : 'none';
      ffmDirectBox.style.display = mode === 'direct' ? '' : 'none';
      updateFFMPreview();
    }));

    // Calculate FFM based on mode
    function getFFM(){
      const mode = $('input[name="ffmMode"]:checked').value;
      if(mode === 'direct'){
        const v = parseFloat(ffmEl.value);
        return Number.isFinite(v) && v>0 ? v : null;
      } else {
        const w = parseFloat(weightEl.value);
        const bf = parseFloat(bodyfatEl.value);
        if(Number.isFinite(w) && w>0 && Number.isFinite(bf) && bf>=0 && bf<70){
          return w * (1 - bf/100);
        }
        return null;
      }
    }

    function classifyEA(ea){
      if(!Number.isFinite(ea)) return {label:'â€”', cls:'mid'};
      if(ea < 30) return {label:'ä½ï¼ˆ<30ï¼‰', cls:'low'};
      if(ea < 45) return {label:'æ³¨æ„ï¼ˆ30â€“45ï¼‰', cls:'mid'};
      return {label:'æœ€ä½³ï¼ˆâ‰¥45ï¼‰', cls:'ok'};
    }

    function fmt(x, digits=1){
      return Number.isFinite(x) ? x.toFixed(digits) : 'â€”';
    }

    function updateFFMPreview(){
      const ffm = getFFM();
      ffmPreviewEl.textContent = fmt(ffm, 1) + (Number.isFinite(ffm) ? ' kg' : '');
      ffmNoteEl.textContent = Number.isFinite(ffm)
        ? 'FFM ç‚ºå»è„‚é«”é‡ï¼ˆå«éª¨éª¼è‚Œã€å™¨å®˜ã€éª¨éª¼èˆ‡é«”æ°´ä»½ç­‰ï¼‰'
        : 'æœªæä¾›è¶³å¤ è³‡è¨Šä»¥ä¼°ç®— FFM';
    }

    [weightEl, bodyfatEl, ffmEl].forEach(el => el.addEventListener('input', updateFFMPreview));

    function calcEA(){
      const ffm = getFFM();
      const ei = parseFloat(eiEl.value);
      const eee = parseFloat(eeeEl.value);
      if(!Number.isFinite(ffm) || ffm<=0){
        eaValueEl.textContent = 'â€”';
        eaClassEl.textContent = 'è«‹å…ˆæä¾› FFMï¼ˆå»è„‚é«”é‡ï¼‰';
        eaClassEl.className = 'tag mid';
        adviceEl.textContent = 'æç¤ºï¼šå¯ç›´æ¥è¼¸å…¥ FFMï¼Œæˆ–æä¾›ã€Œé«”é‡ã€èˆ‡ã€Œé«”è„‚ç‡ã€è®“ç³»çµ±ä¼°ç®—ã€‚';
        return;
      }
      if(!Number.isFinite(ei) || !Number.isFinite(eee)){
        eaValueEl.textContent = 'â€”';
        eaClassEl.textContent = 'è«‹è¼¸å…¥ EI èˆ‡ EEE';
        eaClassEl.className = 'tag mid';
        adviceEl.textContent = 'EI=èƒ½é‡æ”å–ï¼›EEE=é‹å‹•èƒ½é‡æ¶ˆè€—ã€‚å…©è€…çš†ä»¥ã€Œæ¯å¤©ã€ç‚ºåŸºæº–ã€‚';
        return;
      }
      const ea = (ei - eee) / ffm; // kcal/kg FFM/day
      eaValueEl.textContent = fmt(ea, 1) + ' kcal/kg/æ—¥';
      const klass = classifyEA(ea);
      eaClassEl.textContent = klass.label;
      eaClassEl.className = 'tag ' + klass.cls;

      // Contextual advice
      let msg = '';
      const sex = sexEl.value;
      if(ea < 30){
        msg = 'âš ï¸ ç›®å‰ EA ä½æ–¼ 30ï¼Œç–‘ä¼¼ä½èƒ½é‡å¯ç”¨æ€§ï¼ˆLEAï¼‰å€é–“ï¼ŒREDâ€‘S é¢¨éšªé«˜ã€‚å»ºè­°ï¼šå¢åŠ  EIã€é™ä½ EEEã€æˆ–å…©è€…ä¸¦è¡Œï¼Œä¸¦èˆ‡é‹å‹•ç‡Ÿé¤Šå¸«/é†«å¸«è¨è«–ã€‚';
      } else if(ea < 45){
        msg = 'ğŸŸ¡ EA ä»‹æ–¼ 30â€“45ï¼Œå¯èƒ½ä¸è¶³ï¼›å»ºè­°å¾®å¹…æé«˜ EI æˆ–é€±æœŸåŒ–è¨“ç·´è² è·ï¼Œè§€å¯Ÿç”Ÿç†èˆ‡è¡¨ç¾æŒ‡æ¨™ï¼ˆé«”é‡ã€æœˆç¶“/çªå›ºé…®ã€HRVã€ç–²å‹åº¦ç­‰ï¼‰ã€‚';
      } else {
        msg = 'ğŸŸ¢ EA â‰¥ 45ï¼Œå¤šæ•¸è€åŠ›é …ç›®è¦–ç‚ºè¼ƒä½³å€é–“ï¼›ä»å»ºè­°ä¾è¨“ç·´é€±æœŸå‹•æ…‹èª¿æ•´ï¼Œé¿å…é•·æœŸåä½ã€‚';
      }
      if(sex === 'female') msg += ' å¥³æ€§é•·æœŸ LEA å¯èƒ½å½±éŸ¿æœˆç¶“é€±æœŸèˆ‡éª¨å¥åº·ï¼Œè«‹ç‰¹åˆ¥ç•™æ„ã€‚';
      if(sex === 'male') msg += ' ç”·æ€§ä¹Ÿå¯èƒ½å‡ºç¾ LEA/REDâ€‘Sï¼ˆçªå›ºé…®ä¸‹é™ã€éª¨å¯†åº¦å—å½±éŸ¿ï¼‰ï¼Œè«‹ç•™æ„ã€‚';
      adviceEl.textContent = msg;
    }

    $('#calc').addEventListener('click', calcEA);
    $('#reset').addEventListener('click', () => { [weightEl, bodyfatEl, ffmEl, eiEl, eeeEl].forEach(el => el.value=''); updateFFMPreview(); eaValueEl.textContent='â€”'; eaClassEl.textContent='â€”'; eaClassEl.className='tag mid'; adviceEl.textContent='è«‹è¼¸å…¥æ•¸æ“šä»¥å–å¾—å»ºè­°ã€‚'; });

    // Demos (aligned with user's frequent examples)
    $('#demoF').addEventListener('click', ()=>{
      sexEl.value='female';
      $('input[name="ffmMode"][value="calc"]').checked = true; ffmCalcBox.style.display=''; ffmDirectBox.style.display='none';
      weightEl.value = 48; bodyfatEl.value = 22; // å‡è¨­ç¯„ä¾‹
      eiEl.value = 2200; eeeEl.value = 450;
      updateFFMPreview(); calcEA();
    });
    $('#demoM').addEventListener('click', ()=>{
      sexEl.value='male';
      $('input[name="ffmMode"][value="calc"]').checked = true; ffmCalcBox.style.display=''; ffmDirectBox.style.display='none';
      weightEl.value = 60; bodyfatEl.value = 15; // å‡è¨­ç¯„ä¾‹
      eiEl.value = 2600; eeeEl.value = 800;
      updateFFMPreview(); calcEA();
    });

    // Activity rows logic
    let actIdx = 0;
    function addActRow({name='', met='', mins='', w='' }={}){
      const tr = document.createElement('tr');
      const idx = ++actIdx;
      tr.innerHTML = `
        <td>${idx}</td>
        <td><input type="text" placeholder="ä¾‹å¦‚ï¼šé…é€Ÿè·‘" value="${name}"></td>
        <td><input type="number" min="1" step="0.1" placeholder="å¦‚ 10" value="${met}"></td>
        <td><input type="number" min="1" step="1" placeholder="åˆ†é˜" value="${mins}"></td>
        <td><input type="number" min="20" step="0.1" placeholder="é«”é‡" value="${w || weightEl.value}"></td>
        <td class="kcal">0</td>
        <td><button class="btn" aria-label="åˆªé™¤">åˆªé™¤</button></td>
      `;
      actTableBody.appendChild(tr);
      const [nameIn, metIn, minIn, wIn] = $$('input', tr);
      const kcalCell = $('.kcal', tr);
      const delBtn = $('button', tr);

      function recalc(){
        const met = parseFloat(metIn.value);
        const mins = parseFloat(minIn.value);
        const w = parseFloat(wIn.value);
        let kcal = 0;
        if([met, mins, w].every(v => Number.isFinite(v) && v>0)){
          kcal = met * 3.5 * w / 200 * mins;
        }
        kcalCell.textContent = Math.round(kcal);
        sumEEE();
      }
      [metIn, minIn, wIn].forEach(el => el.addEventListener('input', recalc));
      delBtn.addEventListener('click', ()=>{ tr.remove(); sumEEE(); });
      recalc();
    }

    function sumEEE(){
      const total = $$('#actTable tbody tr').reduce((acc, tr)=>acc + (parseFloat($('.kcal', tr).textContent) || 0), 0);
      eeeSumEl.textContent = Math.round(total);
    }

    $('#addAct').addEventListener('click', ()=> addActRow());
    $('#clearAct').addEventListener('click', ()=>{ actTableBody.innerHTML=''; eeeSumEl.textContent='0'; });
    $('#applyEEE').addEventListener('click', ()=>{ eeeEl.value = eeeSumEl.textContent; });

    // Initialize
    updateFFMPreview();
  </script>
</body>
</html>
